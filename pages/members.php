<?php
include '../config/db.php'; // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿßÿ± ŸÖŸÑŸÅ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
session_start(); // ÿ®ÿØÿ° ÿßŸÑÿ¨ŸÑÿ≥ÿ©
if (isset($_SESSION['username'])) {
    // echo "ŸÖÿ±ÿ≠ÿ®Ÿãÿßÿå " . $_SESSION['username'];
} else {
    echo "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ.";
}

?>

<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿπÿ∂ÿßÿ°</title>
    <!-- ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿßÿ®ÿ∑ Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../public/css/members.css">

</head>

<body>

    <div class="container-fluid mt-4">
        <h2 class="text-center mb-4">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿπÿ∂ÿßÿ°</h2>

        <div class="row">
            <!-- ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ£ŸäŸÖŸÜ -->
            <div class="col-md-3">
                <!-- ÿßŸÑÿ®ÿ≠ÿ´ -->
                <div class="mb-3">
                    <input type="text" id="searchMember" class="form-control"
                        placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿ£Ÿà ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®..." dir="rtl" style="text-align: right;">
                </div>


                <!-- ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿµŸÅŸàŸÅ -->
                <div class="row-buttons">


                    <div class="col-button">
                        <button class="btn btn-danger">ÿ≠ÿ∞ŸÅ</button>
                    </div>



                    <!-- ÿßŸÑÿ™ÿπÿØŸäŸÑ -->
                    <div class="col-button">
                        <button class="btn btn-warning" id="editBtn" disabled>ÿ™ÿπÿØŸäŸÑ</button>
                    </div>

                    <!-- ÿßŸÑÿ™ÿπÿØŸäŸÑ -->
                    <div class="modal" tabindex="-1" id="editMemberModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿπÿ∂Ÿà</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="editMemberForm">
                                        <div class="mb-3">
                                            <label for="account_name" class="form-label">ÿßÿ≥ŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®</label>
                                            <input type="text" class="form-control" name="account_name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="account_type" class="form-label">ÿ∑ÿ®Ÿäÿπÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®</label>
                                            <select class="form-control" name="account_type" required>
                                                <option value="ÿπÿ∂Ÿà">ÿπÿ∂Ÿà</option>
                                                <option value="ÿ≤ÿ®ŸàŸÜ">ÿ≤ÿ®ŸàŸÜ</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="account_number" class="form-label">ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®</label>
                                            <input type="text" class="form-control" name="account_number" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="mobile_number" class="form-label">ÿ±ŸÇŸÖ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ</label>
                                            <input type="tel" class="form-control" name="mobile_number" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="address" class="form-label">ÿßŸÑÿπŸÜŸàÿßŸÜ</label>
                                            <textarea class="form-control" name="address" required></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                                    <button type="button" class="btn btn-primary" id="saveEditMember">ÿ≠ŸÅÿ∏
                                        ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
                                </div>
                            </div>
                        </div>
                    </div>





                    <div class="col-button">
                        <!-- ÿ≤ÿ± ŸÅÿ™ÿ≠ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© -->
                        <button class="btn btn-primary" id="openAddMemberModal">ÿ¨ÿØŸäÿØ</button>
                    </div>

                    <!-- ŸÜÿßŸÅÿ∞ÿ© ŸÖŸÜÿ®ÿ´ŸÇÿ© ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿπÿ∂Ÿà ÿ¨ÿØŸäÿØ -->
                    <div class="modal fade" id="addMemberModal" tabindex="-1" aria-labelledby="addMemberModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addMemberModalLabel">ÿ•ÿ∂ÿßŸÅÿ© ÿπÿ∂Ÿà ÿ¨ÿØŸäÿØ</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="ÿ•ÿ∫ŸÑÿßŸÇ"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="addMemberForm">
                                        <div class="mb-3">
                                            <label for="account_name" class="form-label">ÿßÿ≥ŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®</label>
                                            <input type="text" class="form-control" id="account_name"
                                                name="account_name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="account_type" class="form-label">ÿ∑ÿ®Ÿäÿπÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®</label>
                                            <select class="form-control" id="account_type" name="account_type" required>
                                                <option value="ÿπÿ∂Ÿà">ÿπÿ∂Ÿà</option>
                                                <option value="ÿ≤ÿ®ŸàŸÜ">ÿ≤ÿ®ŸàŸÜ</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="account_number" class="form-label">ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®</label>
                                            <input type="text" class="form-control" id="account_number"
                                                name="account_number" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="mobile_number" class="form-label">ÿ±ŸÇŸÖ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ</label>
                                            <input type="number" class="form-control" id="mobile_number"
                                                name="mobile_number" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="address" class="form-label">ÿßŸÑÿπŸÜŸàÿßŸÜ</label>
                                            <input type="text" class="form-control" id="address" name="address"
                                                required>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">ÿ•ŸÑÿ∫ÿßÿ°</button>
                                            <button type="button" class="btn btn-primary" id="saveMember">ÿ≠ŸÅÿ∏</button>
                                        </div>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>


                </div>

                <div class="row-buttons">
                    <div class="col-button">
                        <button class="btn btn-success">ÿµÿ±ŸÅ</button>
                    </div>
                    <div class="col-button">
                        <button class="btn btn-info">ŸÇÿ®ÿ∂</button>
                    </div>
                </div>

                <div class="button-container">
                    <button class="btn btn-secondary"> ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ</button>
                </div>
                <div class="button-container">
                    <button class="btn btn-secondary"> ÿ™ÿµÿØŸäÿ±</button>
                </div>
                <div class="button-container">
                    <button class="btn btn-dark">ŸÉÿ¥ŸÅ ÿ≠ÿ≥ÿßÿ®</button>
                </div>

                <!-- ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
                <div class="button-container">
                    <button class="btn btn-primary back-btn">ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</button>
                </div>
            </div>

            <!-- ÿßŸÑÿ¨ÿØŸàŸÑ ŸÅŸä ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ£Ÿäÿ≥ÿ± -->
            <div class="col-md-9">
                <div class="table-container">

                    <table class="table table-bordered table-striped" dir="rtl">
                        <thead>
                            <tr>
                                <th rowspan="2">ÿßŸÑÿ™ÿ±ŸÇŸäŸÖ</th>
                                <th rowspan="2">ÿßÿ≥ŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®</th>
                                <th colspan="2">ÿßŸÑÿ±ÿµŸäÿØ</th>
                                <th rowspan="2">ÿßŸÑŸÜŸÇÿßÿ∑</th>
                                <th rowspan="2">ÿ∑ÿ®Ÿäÿπÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®</th>
                                <th rowspan="2">ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿÆÿµŸÖ</th>
                                <th rowspan="2">ÿ≥ÿπÿ± ÿßŸÑÿ®Ÿäÿπ</th>
                                <th colspan="3">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ</th>
                                <th colspan="2">ÿ¢ÿÆÿ± ÿ®Ÿäÿπ</th>
                                <th colspan="2">ÿ¢ÿÆÿ± ŸÇÿ®ÿ∂</th>
                            </tr>
                            <tr>
                                <th>ÿπŸÑŸäŸá ŸÖÿØŸäŸÜ</th>
                                <th>ŸÑŸá ÿØÿßÿ¶ŸÜ</th>
                                <th>ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ≥ÿßÿ®</th>
                                <th>ÿ±ŸÇŸÖ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ</th>
                                <th>ÿßŸÑÿπŸÜŸàÿßŸÜ</th>
                                <th>ÿ™ÿßÿ±ŸäÿÆ</th>
                                <th>ÿßÿ¨ŸÖÿßŸÑŸä</th>
                                <th>ÿ™ÿßÿ±ŸäÿÆ</th>
                                <th>ÿßŸÑŸÇŸäŸÖÿ©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php
                            // ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ŸÑÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿπÿ∂ÿßÿ° ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                            $sql = "SELECT * FROM members";
                            $result = mysqli_query($conn, $sql);

                            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ
                            if (mysqli_num_rows($result) > 0) {
                                // ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿµŸÅŸàŸÅ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ
                                while ($row = mysqli_fetch_assoc($result)) {
                                    echo "<tr data-id='" . $row['id'] . "'>";
                                    echo "<td>" . $row['id'] . "</td>";
                                    echo "<td>" . $row['account_name'] . "</td>";
                                    echo "<td>" . $row['balance_debit'] . "</td>";
                                    echo "<td>" . $row['balance_credit'] . "</td>";
                                    echo "<td>" . $row['points'] . "</td>";
                                    echo "<td>" . $row['account_type'] . "</td>";
                                    echo "<td>" . $row['discount_percentage'] . "</td>";
                                    echo "<td>" . $row['sale_price'] . "</td>";
                                    echo "<td>" . $row['account_number'] . "</td>";
                                    echo "<td>" . $row['mobile_number'] . "</td>";
                                    echo "<td>" . $row['address'] . "</td>";
                                    echo "<td>" . $row['last_sale_date'] . "</td>";
                                    echo "<td>" . $row['last_sale_total'] . "</td>";
                                    echo "<td>" . $row['last_payment_date'] . "</td>";
                                    echo "<td>" . $row['last_payment_value'] . "</td>";
                                    echo "</tr>";
                                }
                            } else {
                                echo "<tr><td colspan='14' class='text-center'>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿπÿ±ÿ∂Ÿáÿß</td></tr>";
                            }
                            ?>
                        </tbody>
                    </table>


                </div>
            </div>

        </div>
    </div>



    <!-- ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿä  -->
    <script src="../public/js/members.js"></script>



    <!-- ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿßÿ®ÿ∑ Bootstrap JS (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>